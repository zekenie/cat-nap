!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.catNap=e():t.catNap=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";t.exports={Server:r(3),Endpoint:r(4),Model:r(1),Schema:r(2)}},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(c){i=!0,o=c}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o={paths:Symbol("paths"),dirtyList:Symbol("dirtyList"),parent:Symbol("parent")},a=function(t,e){var r=this,n=Symbol(t);this[o.paths].set(t,n),Object.defineProperty(this,t,{get:function(){return r[n]}})},u=function(){var t=!0,e=!1,r=void 0;try{for(var n,o=this.constructor.schema[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var u=i(n.value,2),c=u[0],s=u[1];a.call(this,c,s)}}catch(f){e=!0,r=f}finally{try{!t&&o["return"]&&o["return"]()}finally{if(e)throw r}}},c=function(){function t(e,n){r(this,t),this[o.parent]=n,this[o.paths]=new Map,this[o.dirtyList]=new Set,u.call(this),this.merge(e)}return n(t,[{key:"clearDirtyList",value:function(){this[o.dirtyList].clear()}},{key:"merge",value:function(t){var e=this;return Object.keys(t).forEach(function(r){var n=t[r],i=e[o.paths].get(r);if(!i){if(e.constructor.schema.strict)return;a.call(e,r),i=e[o.paths].get(r)}e[i]=n,e[o.dirtyList].add(r)}),this}},{key:"reduce",value:function(t,e){var r=!0,n=!1,a=void 0;try{for(var u,c=this[o.paths][Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var s=i(u.value,2),f=s[0],l=s[1];e=t.call(this,e,f,this[l])}}catch(p){n=!0,a=p}finally{try{!r&&c["return"]&&c["return"]()}finally{if(n)throw a}}return e}},{key:"values",get:function(){return Object.assign({},this.reduce(function(t,e,r){return t[e]=r,t},{}))}},{key:"dirtyValues",get:function(){var t={},e=!0,r=!1,n=void 0;try{for(var i,a=this[o.dirtyList][Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=i.value;t[u]=this[u]}}catch(c){r=!0,n=c}finally{try{!e&&a["return"]&&a["return"]()}finally{if(r)throw n}}return Object.assign({},t)}},{key:"parentDoc",get:function(){return this[o.parent]}},{key:"primaryIdentifier",get:function(){return this[this.constructor.schema.primary]}}]),t}();t.exports=c},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(6),a=function(){function t(){var e=this,r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,t),this.data=new Map,this[Symbol.iterator]=this.data[Symbol.iterator].bind(this.data),Object.keys(r).forEach(function(t){return e.set(t,r[t])}),Object.assign(this,i)}return i(t,[{key:"set",value:function(t,e){e.primary&&(this.primary=t),this.data.set(t,new o(e))}},{key:"get",value:function(t){return this.data.get(t)}}]),t}();t.exports=a},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(11).JsonFetcher,a=new o,u=function(){function t(e){n(this,t),this.base=e,this.config({credentials:"include"})}return i(t,[{key:"config",value:function(t){a.config(t)}},{key:"get",value:function(t){return a.get(this.base+t)}},{key:"delete",value:function(t){return a["delete"](base+t)}},{key:"post",value:function(t,e){return a.post(this.base+t,{body:e})}},{key:"put",value:function(t,e){return a.put(base+t,{body:e})}}]),t}();t.exports=u},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=(r(3),r(1),function(t,e){var r=this;return t.map(function(t){return a.call(r,t,e)})}),a=function(t,e){return new this(t,e)},u=function(){function t(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,t),this.parent=r,this.data=new this.constructor.model(e,r.model)}return i(t,[{key:"update",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(!this.id)throw new Error("cannot update document without id. try calling create");this.data.merge(e);var r=this.data.dirtyValues;return this.constructor.server.put(this.url,r).then(function(e){return t.data.merge(e)}).then(function(){return t.data.clearDirtyList()})}},{key:"create",value:function(){var t=this;if(this.id)throw new Error("cannot recreate document that already has identifier");return this.constructor.create(this.data.values).then(function(e){return t.data.merge(e)}).then(function(){return t.data.clearDirtyList()})}},{key:"delete",value:function(){return this.constructor["delete"](this.url)}},{key:"id",get:function(){return this.data[primaryIdentifier]}},{key:"parentUrl",get:function(){return this.parent?this.parent.url:this.constructor.path}},{key:"url",get:function(){var t=void 0;return this.constructor.parents&&(t=this.constructor.parents.get(this.parent.constructor)),[this.parentUrl,t,this.id].filter(function(t){return!!t}).join("/")}}],[{key:"find",value:function(){arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(this.parent)throw new Error("cannot find on nested route");return this.server.get(this.path).then(o.bind(this))}},{key:"delete",value:function(t){return this.server["delete"](t)}},{key:"findById",value:function(t){if(this.parent)throw new Error("cannot find by id on nested route");return this.server.get(this.path+"/"+t).then(a.bind(this))}},{key:"create",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(this.parent)throw new Error("cannot create "+this.name+" with create method because "+this.name+" is a subclass. call create from a parent.");return this.server.post(this.path,t).then(a.bind(this))}}]),t}();t.exports=u,t.exports.Schema=r(2)},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(t){function e(){return r(this,e),n(this,Object.getPrototypeOf(e).apply(this,arguments))}return i(e,t),e}(Error);t.exports=o},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(8),a=r(5),u=function(){this.type&&this.validators.push("type"),this.validators=this.validators.map(function(t){return"string"==typeof t?o[t]:t}).filter(function(t){return!!t})},c=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n(this,t),Object.assign(this,e),this.validators=this.validators||[],u.call(this)}return i(t,[{key:"validate",value:function(t){var e=this,r=this.validators.map(function(e){return e.validator(t)});return Promise.all(r).then(function(r){return r.map(function(r,n){return r?new a(e.validators[n].error(t)):void 0})}).then(function(t){return t.filter(function(t){return!!t})})}}]),t}();t.exports=c},function(t,e){"use strict";t.exports.validator=function(t){var e=/\S+@\S+\.\S+/;return e.test(t)},t.exports.error=function(t){return t+" is not an email address"}},function(t,e,r){"use strict";e.email=r(7),e.required=r(9),e.type=r(10)},function(t,e){"use strict";t.exports.validator=function(t){return!(void 0).required||!!t},t.exports.error=function(){return"Value is required for this path"}},function(t,e){"use strict";t.exports.validator=function(t){return!!t&&t.constructor===(void 0).type},t.exports.error=function(t){return t+" does not match correct type"}},function(t,e,r){!function(e,r){t.exports=r()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.JsonFetcher=e.copy=void 0;var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=r(2),u=function p(t){if(null==t||"object"!=("undefined"==typeof t?"undefined":o(t)))return t;var e=t.constructor();return Object.keys(t).forEach(function(r){t instanceof Object?e[r]=p(t[r]):e[r]=t[r]}),e};e.copy=u;var c={credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}},s=function(t){if("string"===!("undefined"==typeof t?"undefined":o(t)))return t;try{return JSON.stringify(t)}catch(e){}},f=function(t){return"string"==typeof t?t:a.qs.stringify(options.query)},l=e.JsonFetcher=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];n(this,t),this.defaults=Object.assign(e,c)}return i(t,[{key:"config",value:function(t){Object.assign(this.defaults,t)}},{key:"request",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return e=Object.assign(u(this.defaults),e),e.body&&(e.body=s(e.body)),e.query&&(e.query=f(e.query),t+="?"+e.query),fetch(t,e).then(function(t){return t.json()})}}]),t}();["head","options","connect","get","post","put","delete"].reduce(function(t,e){return t[e]=function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.method=e.toUpperCase(),this.request(t,r)},t},l.prototype)},function(t,e){"use strict";var r=function(){for(var t=new Array(256),e=0;256>e;++e)t[e]="%"+((16>e?"0":"")+e.toString(16)).toUpperCase();return t}();e.arrayToObject=function(t,e){for(var r=e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)"undefined"!=typeof t[n]&&(r[n]=t[n]);return r},e.merge=function(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];t[r]=!0}return t}if("object"!=typeof t)return[t].concat(r);var i=t;return Array.isArray(t)&&!Array.isArray(r)&&(i=e.arrayToObject(t,n)),Object.keys(r).reduce(function(t,i){var o=r[i];return Object.prototype.hasOwnProperty.call(t,i)?t[i]=e.merge(t[i],o,n):t[i]=o,t},i)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),n="",i=0;i<e.length;++i){var o=e.charCodeAt(i);45===o||46===o||95===o||126===o||o>=48&&57>=o||o>=65&&90>=o||o>=97&&122>=o?n+=e.charAt(i):128>o?n+=r[o]:2048>o?n+=r[192|o>>6]+r[128|63&o]:55296>o||o>=57344?n+=r[224|o>>12]+r[128|o>>6&63]+r[128|63&o]:(i+=1,o=65536+((1023&o)<<10|1023&e.charCodeAt(i)),n+=r[240|o>>18]+r[128|o>>12&63]+r[128|o>>6&63]+r[128|63&o])}return n},e.compact=function(t,r){if("object"!=typeof t||null===t)return t;var n=r||[],i=n.indexOf(t);if(-1!==i)return n[i];if(n.push(t),Array.isArray(t)){for(var o=[],a=0;a<t.length;++a)t[a]&&"object"==typeof t[a]?o.push(e.compact(t[a],n)):"undefined"!=typeof t[a]&&o.push(t[a]);return o}for(var u=Object.keys(t),c=0;c<u.length;++c){var s=u[c];t[s]=e.compact(t[s],n)}return t},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null===t||"undefined"==typeof t?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}},function(t,e,r){"use strict";var n=r(4),i=r(3);t.exports={stringify:n,parse:i}},function(t,e,r){"use strict";var n=r(1),i={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,decoder:n.decode},o=function(t,e){for(var r={},n=t.split(e.delimiter,e.parameterLimit===1/0?void 0:e.parameterLimit),i=0;i<n.length;++i){var o=n[i],a=-1===o.indexOf("]=")?o.indexOf("="):o.indexOf("]=")+1;if(-1===a)r[e.decoder(o)]="",e.strictNullHandling&&(r[e.decoder(o)]=null);else{var u=e.decoder(o.slice(0,a)),c=e.decoder(o.slice(a+1));Object.prototype.hasOwnProperty.call(r,u)?r[u]=[].concat(r[u]).concat(c):r[u]=c}}return r},a=function c(t,e,r){if(!t.length)return e;var n,i=t.shift();if("[]"===i)n=[],n=n.concat(c(t,e,r));else{n=r.plainObjects?Object.create(null):{};var o="["===i[0]&&"]"===i[i.length-1]?i.slice(1,i.length-1):i,a=parseInt(o,10);!isNaN(a)&&i!==o&&String(a)===o&&a>=0&&r.parseArrays&&a<=r.arrayLimit?(n=[],n[a]=c(t,e,r)):n[o]=c(t,e,r)}return n},u=function(t,e,r){if(t){var n=r.allowDots?t.replace(/\.([^\.\[]+)/g,"[$1]"):t,i=/^([^\[\]]*)/,o=/(\[[^\[\]]*\])/g,u=i.exec(n),c=[];if(u[1]){if(!r.plainObjects&&Object.prototype.hasOwnProperty(u[1])&&!r.allowPrototypes)return;c.push(u[1])}for(var s=0;null!==(u=o.exec(n))&&s<r.depth;)s+=1,(r.plainObjects||!Object.prototype.hasOwnProperty(u[1].replace(/\[|\]/g,""))||r.allowPrototypes)&&c.push(u[1]);return u&&c.push("["+n.slice(u.index)+"]"),a(c,e,r)}};t.exports=function(t,e){var r=e||{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.delimiter="string"==typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:i.delimiter,r.depth="number"==typeof r.depth?r.depth:i.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:i.arrayLimit,r.parseArrays=r.parseArrays!==!1,r.decoder="function"==typeof r.decoder?r.decoder:i.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:i.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:i.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:i.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:i.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:i.strictNullHandling,""===t||null===t||"undefined"==typeof t)return r.plainObjects?Object.create(null):{};for(var a="string"==typeof t?o(t,r):t,c=r.plainObjects?Object.create(null):{},s=Object.keys(a),f=0;f<s.length;++f){var l=s[f],p=u(l,a[l],r);c=n.merge(c,p,r)}return n.compact(c)}},function(t,e,r){"use strict";var n=r(1),i={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},o={delimiter:"&",strictNullHandling:!1,skipNulls:!1,encode:!0,encoder:n.encode},a=function u(t,e,r,i,o,a,c,s,f){var l=t;if("function"==typeof c)l=c(e,l);else if(l instanceof Date)l=l.toISOString();else if(null===l){if(i)return a?a(e):e;l=""}if("string"==typeof l||"number"==typeof l||"boolean"==typeof l||n.isBuffer(l))return a?[a(e)+"="+a(l)]:[e+"="+String(l)];var p=[];if("undefined"==typeof l)return p;var d;if(Array.isArray(c))d=c;else{var y=Object.keys(l);d=s?y.sort(s):y}for(var h=0;h<d.length;++h){var v=d[h];o&&null===l[v]||(p=Array.isArray(l)?p.concat(u(l[v],r(e,v),r,i,o,a,c,s,f)):p.concat(u(l[v],e+(f?"."+v:"["+v+"]"),r,i,o,a,c,s,f)))}return p};t.exports=function(t,e){var r,n,u=t,c=e||{},s="undefined"==typeof c.delimiter?o.delimiter:c.delimiter,f="boolean"==typeof c.strictNullHandling?c.strictNullHandling:o.strictNullHandling,l="boolean"==typeof c.skipNulls?c.skipNulls:o.skipNulls,p="boolean"==typeof c.encode?c.encode:o.encode,d=p?"function"==typeof c.encoder?c.encoder:o.encoder:null,y="function"==typeof c.sort?c.sort:null,h="undefined"==typeof c.allowDots?!1:c.allowDots;if(null!==c.encoder&&void 0!==c.encoder&&"function"!=typeof c.encoder)throw new TypeError("Encoder has to be a function.");"function"==typeof c.filter?(n=c.filter,u=n("",u)):Array.isArray(c.filter)&&(r=n=c.filter);var v=[];if("object"!=typeof u||null===u)return"";var b;b=c.arrayFormat in i?c.arrayFormat:"indices"in c?c.indices?"indices":"repeat":"indices";var m=i[b];r||(r=Object.keys(u)),y&&r.sort(y);for(var g=0;g<r.length;++g){var w=r[g];l&&null===u[w]||(v=v.concat(a(u[w],w,m,f,l,d,n,y,h)))}return v.join(s)}}])})}])});
//# sourceMappingURL=index.js.map